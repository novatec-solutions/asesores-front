<div fxLayout="column" fxLayoutGap="25px">
  <div fxFlex fxLayout="column" fxLayoutAlign="stretch space-between">
    <label class="title gray-color mt20"><b>Consulta de consumos: Detalle de Cuentas del Usuario</b></label>
    <label class="title blue-color py20"><b>Buscar</b></label>
    <mat-card fxFlex>
      <mat-card-title class="card-title"><b>Detalles de Cuentas de Usuario</b></mat-card-title>
      <p class="subtitle mt15">Selecciona el tipo de búsqueda</p>
      <div fxLayout="row" fxLayout.lt-md="column" fxLayoutAlign="start start" fxLayoutAlign.lt-md="stretch" fxLayoutGap="12px" 
      class="cards-xs">
        <mat-card class="{{email?'active':'deactivated'}}" fxLayout="row" fxLayoutAlign="start center" fxFlex.gt-sm="28" 
         fxLayoutGap="7px" (click)="searchSelection(1)">
          <mat-icon >panorama_fish_eye</mat-icon>
          <label>Correo electrónico (Completo)</label>
        </mat-card>
        <mat-card class="{{hogar?'active':'deactivated'}}" fxLayout="row" fxLayoutAlign="start center" fxFlex.gt-sm="28" 
         fxLayoutGap="7px" (click)="searchSelection(2)">
          <mat-icon >panorama_fish_eye</mat-icon>
          <label>Nro Cuenta Claro Hogar</label>
        </mat-card>
        <mat-card class="{{movil?'active':'deactivated'}}" fxLayout="row" fxLayoutAlign="start center" fxFlex.gt-sm="28" 
         fxLayoutGap="7px" (click)="searchSelection(3)">
          <mat-icon >panorama_fish_eye</mat-icon>
          <label>Nro Línea Claro Móvil</label>
        </mat-card>
      </div>
      <p class="subtitle mt15">Ingresa tu búsqueda</p>
      <form [formGroup]="searchForm" (ngSubmit)="onSearchUser()" novalidate fxLayout="row wrap" fxLayout.lt-md="column" fxLayoutAlign="start center" fxLayoutAlign.lt-md="stretch" fxLayoutGap="30px">
        <div fxFlex fxFlex.gt-sm="49" fxLayout="row" fxLayout.lt-md="column" fxLayoutAlign="start center" 
        fxLayoutAlign.lt-md="stretch" fxLayoutGap.gt-sm="25px" fxLayoutGap.lt-md="5px">
          <label class="subtitle">Valor:</label>
          <div class="tag-group" fxFlex>
            <mat-icon class="search-icon">search</mat-icon>
            <div fxLayout="column">
             <input type="{{sType=='email'?'email':'number'}}" formControlName="lookupValue" appearance="outline"
              fxFlex [ngClass]="{'err-box':searchForm.get('lookupValue')!.hasError('pattern')}" class="input-st">
              <label class="err-text pt5" *ngIf="sType=='email' && searchForm.get('lookupValue')!.hasError('pattern')">Campo obligatorio, debe escribir un email correcto</label>
              <label class="err-text pt5" *ngIf="sType=='hogar' && searchForm.get('lookupValue')!.hasError('pattern')">Campo obligatorio</label>
              <label class="err-text pt5" *ngIf="sType=='movil' && searchForm.get('lookupValue')!.hasError('pattern')">Campo obligatorio, debe inciar en 3 y contener 10 digitos</label>
            </div>
          </div>
        </div>
        <div fxFlex fxLayoutAlign.lt-md="center center" >
          <button class="btn" type="submit" class="{{searchForm.invalid || sType==''?'bg-light-grey':'bg-red'}}" [disabled]="searchForm.invalid || sType==''">Buscar</button>
        </div>
      </form>
    </mat-card>
  </div>

  <div class="spinner-container" *ngIf="loading; else loaded">
    <mat-spinner [diameter]="40" [strokeWidth]="10"></mat-spinner>
  </div>

  <ng-template #loaded>
    <div class="{{visible ?'visible':'hide'}}" fxFlex>
      <mat-accordion multi fxFlex="100">
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title class="card-title"><b>Datos del usuario</b></mat-panel-title>
          </mat-expansion-panel-header>
          <mat-card >
            <form [formGroup]="userForm" class="form-card" fxLayout.lt-md="column" fxLayoutAlign.lt-md="start stretch" fxLayoutGap="10px"
            fxLayout.gt-sm="row " fxLayoutAlign.gt-sm="space-around start" fxLayoutGap.gt-sm="30px">
              <div fxLayout="column" fxLayoutGap="10px" fxFlex.gt-sm="60" fxFlex>
                <div fxLayout.gt-sm="row" fxLayoutAlign.gt-sm="space-between end" fxLayoutGap="10px"
                fxLayout.lt-md="column"  fxLayoutAlign=" stretch">
                  <div fxLayout="column" fxFlex>
                    <label>Email:</label>
                    <input class="input-st" formControlName="mail">
                  </div>
                  <button #btnMail appRoleStyle
                  class="{{userForm.get('mail').value ==''?'bg-light-grey':'bg-red'}} btn w-130" 
                  (click)="modifyMail(userData)" 
                  [disabled]="userForm.get('mail').value ==''">
                    Cambiar Email
                  </button>
                </div>
                <div fxLayout.gt-sm="row" fxLayoutAlign.gt-sm="space-between end" fxLayoutGap="10px"
                fxLayout.lt-md="column" fxLayoutAlign=" stretch">
                  <div fxLayout="column" fxFlex >
                    <label>Nombre:</label>
                    <input class="input-st w-250 mb10" formControlName="firstName">
                    <label>Apellido:</label>
                    <input class="input-st" formControlName="lastName">
                  </div>
                  <button #btnNames class="{{userForm.get('firstName').value =='' || userForm.get('lastName').value ==''?'bg-light-grey':'bg-red'}} btn w-130"
                  (click)="modifyNames(userData)"
                  [disabled]="userForm.get('firstName').value =='' || userForm.get('lastName').value ==''">
                    Cambiar Nombres
                  </button>
                </div>
              </div>
              <div fxLayout="column" fxLayoutGap="10px" fxFlex.gt-sm="20">
                <div fxLayout="column">
                  <label>Nro Cuenta Claro:</label>
                  <input class="input-st" fxFlex disabled value="{{userData?.fixedAccount}}">
                </div>
                <div fxLayout="column">
                  <label>Medio de pago:</label>
                  <input class="input-st" disabled value="{{getPaymentType(userData?.paymentType)}}">
                </div>
                <div fxLayout="column">
                  <label>No de cuenta:</label>
                  <input class="input-st" disabled value="{{userData?.idNumber}}">
                </div>
              </div>
              <div fxLayout="column" fxLayoutGap="10px" fxFlex.gt-sm="20">
                <div fxLayout="column">
                  <label>Id interno del usuario:</label>
                  <input class="input-st" disabled value="{{userData?.customerId}}">
                </div>
                <div fxLayout fxLayoutAlign="center center">
                  <button class="btn bg-blue w-130 mt20" (click)="changePassword()">Cambiar clave</button>
                </div>
              </div>
            </form>
          </mat-card>
          <div fxLayout="row" 
          fxLayoutAlign="center center" appRoleStyle>
            <button class="btn bg-gray mt15" (click)="deleteAccount()">Eliminar cuenta del usuario</button>
          </div> 
        </mat-expansion-panel>
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title class="card-title"><b>Suscripciones del usuario</b></mat-panel-title>
          </mat-expansion-panel-header>
          <div fxLayout="column" fxLayoutAlign=" stretch" fxLayoutGap="20px">
            <app-calendar (selectedDate)="dateChange($event)"></app-calendar>
            <app-table dataForTable="{{dataTableSubscriptions}}"></app-table>
          </div>
        </mat-expansion-panel>
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title class="card-title"><b>Dispositivos del usuario</b></mat-panel-title>
          </mat-expansion-panel-header>
          <app-table dataForTable="{{dataTableDevices}}"></app-table>
        </mat-expansion-panel>
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title class="card-title"><b>Rentas del usuario</b></mat-panel-title>
          </mat-expansion-panel-header>
          <div fxLayout="column" fxLayoutAlign=" stretch" fxLayoutGap="20px">
            <app-calendar (selectedDate)="dateChange($event)"></app-calendar>
            <app-table dataForTable="{{dataTableRent}}"></app-table>
          </div>
        </mat-expansion-panel>
      </mat-accordion>
    </div>
  </ng-template>
</div>
